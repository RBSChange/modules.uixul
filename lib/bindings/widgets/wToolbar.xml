<?xml version="1.0"?>
<bindings
	xmlns="http://www.mozilla.org/xbl"
	xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">


<!--
wToolbar
	@author INTbonjF
	@date   2006-03-16

	Dynamic toolbar which only presents the actions related to the selected elements
	in the attached component (wtree or wlist).
-->
	<binding id="wToolbar" extends="widgets.wContextActionsContainer#wContextActionsContainer">


		<implementation>


			<field name="_defaultAttachmentAttribute">'actions-select'</field>

			<field name="_isToolBar">true</field>

			<field name="_commandPrefix">"wCommandWithoutLabel"</field> <!--WithoutLabel-->

			<constructor><![CDATA[
				var container = this.getElementById('widgetsContainer');
				this._dynamicActionsOffset = container.childNodes.length;
			]]></constructor>

			<method name="createItem">
				<parameter name="commandId" />
				<body><![CDATA[
					var item = document.createElement('toolbarbutton');
					item.setAttribute('commandid', commandId);
					return item;
				]]></body>
			</method>


			<method name="createSeparator">
				<body><![CDATA[
					var item = document.createElement('toolbarseparator');
					return item;
				]]></body>
			</method>


			<method name="createActionGroup">
				<parameter name="label" />
				<parameter name="icon" />
				<parameter name="actions" />
				<body><![CDATA[
					var item = document.createElement('toolbarbutton');
					item.setAttribute('tooltiptext', label);
					item.setAttribute('image', icon);
					item.setAttribute('type', 'menu');
					var menupopup = document.createElement('menupopup');

					var attachedComponent = this.getAttachedComponent();

					var checkRight = ('getSelectedComponents' in attachedComponent) && ('checkSecurity' in attachedComponent);
					var hideGroupe = true;

					if (checkRight)
					{
						var documents = attachedComponent.getSelectedComponents();
						var countDocument = documents.document.length();
					}

					for (var a in actions)
					{
						var actionName = actions[a];

						if (checkRight)
						{
							var display = true;
							for (var i=0; i<countDocument; i++)
							{
								var seldoc = documents.document[i];
								if (!seldoc) { continue;}
								if (!attachedComponent.checkSecurity(actionName, seldoc)
									|| !attachedComponent.checkDisplay(actionName, seldoc, countDocument))
								{
									display = false;
									break;
								}
							}
							if (!display){ continue; }
						}
						
						var menuitem = document.createElement('menuitem');
						menuitem.setAttribute('class', 'wtoolbar');						
						if (this.handleCommand(actionName, menuitem, true))
						{
							hideGroupe = false;	
							menupopup.appendChild(menuitem);
						}
					}
					if (hideGroupe)
					{
						item.setAttribute('collapsed', 'true');
					}
					else
					{
						item.appendChild(menupopup);
					}
					return item;
				]]></body>
			</method>


			<method name="getEventType">
				<body><![CDATA[
					return 'select';
				]]></body>
			</method>


			<method name="hideRefresh">
				<body><![CDATA[
					this.getElementById("refreshbutton").setAttribute("collapsed", "true");
				]]></body>
			</method>


			<method name="showRefresh">
				<body><![CDATA[
					this.getElementById("refreshbutton").removeAttribute("collapsed");
				]]></body>
			</method>


		</implementation>


		<xbl:content xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" xmlns:xbl="http://www.mozilla.org/xbl">
			<vbox flex="1" xbl:inherits="flex" style="overflow: hidden">
				<toolbox flex="1" anonid="observesContainer" orient="horizontal" dir="normal" class="change-toolbox" xbl:inherits="class">
					<toolbar anonid="widgetsContainer" flex="1" orient="horizontal" dir="normal" class="change-toolbar">
						<toolbarbutton anonid="refreshbutton" image="{IconsBase}/small/shadow/refresh.png" tooltiptext="&amp;modules.uixul.bo.actions.Refresh;" oncommand="refresh()" />
						<xbl:children includes="toolbarbutton" />
					</toolbar>
				</toolbox>
			</vbox>
		</xbl:content>


    </binding>


</bindings>
