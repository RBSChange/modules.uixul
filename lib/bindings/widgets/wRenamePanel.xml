<?xml version="1.0"?>
<bindings
	xmlns="http://www.mozilla.org/xbl"
	xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">


<!--
wRenameBox
	@author INTbonjF
	@date   2006-04-18
-->
	<binding
		id="wRenamePanel" extends="widgets.wPanel#wPanel">


		<implementation>

			<field name="_defaultAttachmentAttribute">'selectedcomponents'</field>

			<field name="_workingLanguage">null</field>

			<property name="maxItemCount">
				<getter><![CDATA[
					return 1;
				]]></getter>
			</property>


			<constructor>
			</constructor>


			<method
				name="handleBroadcast"
				doc-access="private">
				<parameter name="observes" />
				<body><![CDATA[
					if ( ! this.hasAttribute('collapsed') )
					{
					    this._workingLanguage = '';
						var val = this.getAttribute('selectedcomponents');
						if (val)
						{
							var container = this.getElementById('container');
							var documents = new XML(val);
							var nbItem = 0;
						    if (this.getModule().isContextLangAvailable(documents.document[0]))
						    {
							    if (this._workingLanguage == '')
							    {
							        this._workingLanguage = documents.document[0].component.(@name=="lang").toString();
							    }

								this.addItem(
									documents.document[0].component.(@name=="id"),
									documents.document[0].component.(@name=="lang"),
									documents.document[0].component.(@name=="revision"),
									documents.document[0].component.(@name=="label")
									);

							    nbItem++;
							}

							if (nbItem == 0)
							{
							    this.hide();
							}
						}
					}
				]]></body>
			</method>


			<method name="addItem">
				<parameter name="id" />
				<parameter name="lang" />
				<parameter name="revision" />
				<parameter name="label" />
				<body><![CDATA[
					var labelElm = this.getElementById('theLabel');
					labelElm.setAttribute('crop', this.crop);
					labelElm.setAttribute('value', label + " :");

					var textboxElm = this.getElementById('theTextbox');
					textboxElm.setAttribute('style', 'margin: 0px 0px 5px 10px');
					textboxElm.setAttribute('value', label);
					textboxElm.setAttribute('document', id+'/'+lang+'/'+revision);
					textboxElm.setAttribute('tooltiptext', "&modules.uixul.bo.renamePanel.Type-in-new-label-for; "+label);
				]]></body>
			</method>


			<method name="submit">
				<body><![CDATA[
					var container = this.getElementById('container');
					var value = [ ];
					for (var i=0 ; i<container.childNodes.length ; i++)
					{
						var child = container.childNodes[i];
						if (child.hasAttribute('document'))
						{
							var id = child.getAttribute('document');
							var label = child.value;
							value[id] = label;
						}
					}

					this.getController().execute(
						"&modules.uixul.bo.renamePanel.Renaming;",
						this, "{K::GENERIC_MODULE_NAME}", "Rename",
						{
							{K::LABEL_ACCESSOR}: value,
							{K::LANG_ACCESSOR}: this._workingLanguage
						});

				]]></body>
			</method>


			<method name="onRenameSuccess">
				<parameter name="e4x" />
				<body><![CDATA[
					try
					{
					    this.getModule().refreshAll(true);
					} 
					catch (e)
					{
						wCore.error("wRenamePanel.onRenameSuccess", [e4x], e);
					}
					this.hide();
				]]></body>
			</method>


		</implementation>


		<xbl:content
			xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
			xmlns:xbl="http://www.mozilla.org/xbl">
			<vbox flex="1" class="panel" style="min-height: 100px">
				<wpanelheader icon="{IconsBase}/command/shadow/element_into_input.png" label="&amp;modules.uixul.bo.renamePanel.Panel-title;" />
				<toolbox class="change-toolbox">
					<toolbar class="change-toolbar">
						<toolbarbutton xbl:inherits="disabled" anonid="btnSubmit" tooltiptext="&amp;modules.uixul.bo.renamePanel.Apply-changes;" image="{IconsBase}/small/shadow/check.png" oncommand="submit()">
							<observes element="wcontroller" attribute="disabled" />
						</toolbarbutton>
						<spacer flex="1" />
					</toolbar>
				</toolbox>
				<vbox flex="1" anonid="container">
					<label anonid="theLabel" crop="end" xbl:inherits="crop" />
					<textbox anonid="theTextbox" />
				</vbox>
			</vbox>
		</xbl:content>


    </binding>


</bindings>
