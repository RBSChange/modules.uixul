<?xml version="1.0"?>
<bindings
	xmlns="http://www.mozilla.org/xbl"
	xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

<!--
################################################################################
## wToolbarSubmitButton                                                       ##
################################################################################
-->

	<binding id="wSelectorSelectButton" extends="widgets.wWidget#wWidget">

		<xbl:content
			xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
			xmlns:xbl="http://www.mozilla.org/xbl">
			<button anonid="button" xbl:inherits="accesskey,autoCheck,checkState,checked,command,crop,dir,disabled,dlgType,group,icon,image,label,open,orient,tabindex,type,flex" oncommand="createNew()" />
		</xbl:content>


		<implementation>


			<field name="_defaultAttachmentAttribute">'selectedcomponents'</field>
			<field name="_allowedComponents">null</field>


			<property name="allowedComponents">
				<getter><![CDATA[
					if (this._allowedComponents == null)
					{
						var allowed = this.getModule().getAttribute('allowedcomponents');
						if (allowed && allowed.length)
						{
							this._allowedComponents = allowed.split(/[\s,]+/);
						}
						else
						{
							this._allowedComponents = [ ];
						}
					}
					return this._allowedComponents;
				]]></getter>
			</property>


			<method name="handleBroadcast">
				<parameter name="observes" />
				<body><![CDATA[
					var canSelect = true;
					var documents = new XML(this.getAttribute(this._defaultAttachmentAttribute));
					for (var i=0 ; i<documents.document.length() && canSelect ; i++)
					{
						if ( ! this.isComponentAllowed(documents.document[i].component.(@name=="type").toString()) )
						{
							canSelect = false;
						}
					}
					if (canSelect)
					{
						this.removeAttribute("disabled");
					}
					else
					{
						this.setAttribute("disabled", "true");
					}
				]]></body>
			</method>


			<method name="isComponentAllowed">
				<parameter name="type" />
				<body><![CDATA[
					var allowed = false;

					// If nothing specified, all components are allowed.
					if (this.allowedComponents.length == 0)
					{
						allowed = true;
					}
					else
					{
						for (var i=0 ; i<this.allowedComponents.length && allowed == false ; i++)
						{
							if (this.allowedComponents[i] == type)
							{
								allowed = true;
							}
						}
					}
					return allowed;
				]]></body>
			</method>


		</implementation>

	</binding>

</bindings>
